<!DOCTYPE html>
<html>
  <head>
    <title>aphorisms.io</title>
    <link href="css/styles.css" rel="stylesheet">
    <script src="https://unpkg.com/vue"></script>
  </head>
  <body class="bg-gray-200">
    <div id="app" class="">
        
        <div class="text-center mt-10">
            <p class="text-gray-600 italic text-sm">this round's prompt is...</p>
            <p id="prompt" class="text-4xl"></p>
            <p id="timer" class="font-serif text-6xl"></p>
        </div>
        
        <div class="my-40 justify-items-center mx-auto grid gap-5 grid-cols-2 grid-rows-3 xl:grid-cols-5 xl:grid-rows-1">
            <player-box id="1" color="text-red-400" name="Player 1"></player-box>
            <player-box id="2" color="text-blue-400" name="Player 2"></player-box>
            <player-box id="3" color="text-green-400" name="Player 3"></player-box>
            <player-box id="4" color="text-yellow-500" name="Player 4"></player-box>
            <player-box id="5" color="text-purple-500" name="Player 5"></player-box>
        </div>

        <div class="mx-auto w-1/3 text-center justify-items-center bg-white pb-10">
            <p class="my-3 font-bold" id="youAreMessage"></p>
            <p>Enter your Aphorism:</p>
            <form id="form" action="">
                <input class="outline-black w-1/2 mx-10" id="input" maxlength="130" autocomplete="off" />
                <button class="rounded-lg px-3 py-1 bg-gray-300">Send</button>
            </form>
            <button id="nextRoundButton" class="rounded-lg px-3 py-1 mt-3 bg-gray-300">Ready for Next Round</button>
        </div>

    </div>
    <script src="js/components.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();

        let players = []
        for (i = 0; i < 5; i++) 
        {
            players.push(document.getElementById(String(i+1)))
        }

        var form = document.getElementById('form');
        var input = document.getElementById('input');
        var timer = document.getElementById('timer');
        var prompt = document.getElementById('prompt');
        var nextRoundButton = document.getElementById('nextRoundButton');
        var time
        var playerNumber;

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            if (input.value) {
            socket.emit('chat message', [input.value, playerNumber]);
            input.value = '';
            }
        });

        nextRoundButton.addEventListener("click", function() {
            socket.emit('player ready', playerNumber);
        });

        socket.on('chat message', function(msg) {
            document.getElementById(msg[1]).querySelector("#poem").innerHTML = msg[0];
        });

        socket.on('cannot join', function(){
            document.body.innerHTML = '<h1> ROOM FULL </h1>';
        })

        socket.on('assign player', function(playerData) {
            prompt.innerHTML = playerData['prompt'];
            time = playerData['time'];
            playerNumber = String(playerData['playerNumber']);
            document.getElementById('youAreMessage').innerHTML = `You Are Player ${playerNumber}`;
            setInterval(function(){ 
                if(time > 0){
                    time--;
                    timer.innerHTML = time; 
                }

                if(time <= 0)
                {
                        timer.innerHTML = "ROUND OVER";
                }
            }, 1000);
        })

        socket.on('new prompt', function(data) {
            prompt.innerHTML = data['prompt'];
            time = data['maxTime'];
        })

        socket.on('players changed', function(playerAmount) {
            for (i = 0; i < players.length; i++) 
            {
                players[i].style.visibility = "hidden";
            }

            for (i = 0; i < playerAmount; i++) 
            {
                players[i].style.visibility = "initial";
            }
        })

        

        

    </script>
  </body>
</html>